
{% extends"base.html.twig" %}

{% set totalHT=0 %}
{% set totalTTC=0 %}


{% block body %}

    <!-- breadcrumbs -->
    <div class="breadcrumbs">
        <div class="container">
            <ol class="breadcrumb breadcrumb1">
                <li><a href="{{ path('souk_el_medina_pidev_homepage') }}"><span class="glyphicon glyphicon-home" aria-hidden="true"></span>Home</a></li>
                <li class="active">Checkout Page</li>
            </ol>
        </div>
    </div>
    <!-- //breadcrumbs -->
    <!-- checkout -->
    <div class="checkout">
        <div class="container">

            <h2>VALIDATE YOUR CART: <span>{{ qteProduitPanier }} Products</span></h2>
            <div class="clearfix"></div>
            <div class="checkout-right">

                <table class="timetable_sub">
                    <thead>
                    <tr>
                        <th>SL No.</th>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Product Name</th>
                        <th>Price</th>
                        <th>A.Price</th>

                    </tr>
                    </thead>
                    {% if produits|length == 0 %}
                        <tr>
                            <td colspan="7"> <center><strong>Aucun articles dans votre panier</strong></center> </td>
                        </tr>
                    {% endif %}
                    {% for produit in produits %}
                        <tr class="rem1">
                            <form action="{{ path('souk_el_medina_panier_ajouter_panier',{'id': produit.idproduit}) }}"  method="get">
                                <td class="invert">1</td>
                                <td class="invert-image"><a href="{{ path('souk_el_medina_pidev_detail',{'id':produit.idproduit}) }}"><img src="{{ asset('images/' ~produit.idproduit~ '.png') }}" alt=" " class="img-responsive" /></a></td>
                                <td class="invert">{{  panier[produit.idproduit] }} </td>

                                <td class="invert">{{ produit.nomproduit }}</td>

                                <td class="invert">${{ produit.prixproduit }}</td>
                                <td class="invert">${{ produit.prixproduit * panier[produit.idproduit] }}</td>

                            </form>
                        </tr>
                        {% set totalHT = totalHT + (produit.prixproduit* panier[produit.idproduit]) %}
                        {% set totalTTC = totalTTC +  (produit.prixproduit* panier[produit.idproduit]) %}

                    {% endfor %}



                </table>
            </div>
            <div class="checkout-left">

                <div class="checkout-left-basket">

                    {% if produits|length != 0 %}

                        <h4>Continue to basket</h4>
                        <ul>
                            <li>Total HT <i>-</i> <span>${{ totalHT }} </span></li>
                            <li>Total TVA(0.0%) <i>-</i> <span>Pas de TVA applicable </span></li>
                            <li>Total <i>-</i> <span>${{ totalHT }}</span><span id="paypal-button" aria-hidden="false"></span></li>
                        </ul>

                    {% endif %}
                </div>

                <div class="checkout-right-basket">
                    <a href="{{ path('souk_el_medina_panier_homepage') }}"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>Retour</a>
                   <!-- <a href="{{ paypal }}"><span class="glyphicon glyphicon-credit-card" aria-hidden="false"></span>Payer</a>-->

                </div>
                <div class="clearfix"> </div>

                <script>
                    paypal.Button.render({
                        env: 'sandbox', // Or 'sandbox',

                        commit: true, // Show a 'Pay Now' button

                        style: {
                            color: 'gold',
                            shape:'pill',
                            size: 'small'
                        },

                        payment: function() {
                            return paypal.request.post('http://localhost/PiDevWeb/web/paypalid').then(function(data) {
                                return data.id;
                            });
                        },

                        onAuthorize: function(data, actions) {
                            return paypal.request.post('http://localhost/PiDevWeb/web/preparecommande', {
                                paymentID: data.paymentID,
                                payerID: data.payerID
                            }).then(function () {
                                            alert('Merci pour votre achat');
                                window.location.replace("http://localhost/PiDevWeb/web/indexfacture");
                                // The payment is complete!
                                // You can now show a confirmation message to the customer
                            });

                        },

                        onCancel: function(data, actions) {
                            alert('echec paiement');
                            window.location.replace("http://localhost/PiDevWeb/web/cancelcommande");
                            /*
                             * Buyer cancelled the payment
                             */
                        },

                        onError: function(err) {
                         console.log('erreur: ',err);
                            /*
                             * An error occurred during the transaction
                             */
                        }
                    }, '#paypal-button');
                </script>
            </div>
        </div>
    </div>
    <!-- //checkout -->



{% endblock %}